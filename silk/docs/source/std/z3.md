# `std::runtime::z3` â€” Z3 SMT Solver (C API Bindings)

Status: **implemented (full raw bindings)**.

`std::runtime::z3` provides low-level `ext` bindings for the Z3 C API.
It is intended for user-space programs that want to call into Z3 directly.

This module is a direct, unsafe FFI surface:

- all Z3 opaque handles are represented as `u64` (raw pointers),
- all Z3 `const char *` strings are represented as `u64`,
- pointer parameters (including `T*` / `T const*` / `T[]`) are represented as `u64`.

The module does **not** provide a safe, ownership-tracked wrapper. Callers are
responsible for using the Z3 reference-counting APIs correctly.

## Vendored Dependencies + Linking

On the hosted `linux/x86_64` baseline, the Silk toolchain vendors:

- Z3 headers under `vendor/include` (e.g. `z3.h`, `z3_api.h`, `z3_fixedpoint.h`, ...),
- a pinned Z3 static archive: `vendor/lib/x64-linux/libz3.a`.

When `std::runtime::z3` is present in the module set, `silk build` auto-links
the vendored `libz3.a` into executable and shared-library outputs. Auto-linking
also applies when linking `.o`/`.a` inputs that reference Z3 `Z3_*` symbols.

In staged/installed toolchains, the vendored archive is expected under the
compiler prefix:

- `build/lib/silk/vendor/lib/x64-linux/` (repo build prefix)
- `<prefix>/lib/silk/vendor/lib/x64-linux/` (installed)

When linking the static archive into an executable/shared library, the driver
also adds runtime dynamic dependencies:

- `libstdc++.so.6`
- `libpthread.so.0`
- `libm.so.6`

## Static Constructors

The vendored Z3 static archive contains `.init_array` constructors (C++ static
initialization).

Silk executables do not use libc `crt1`, so the native backend runs linked
`.init_array` constructors from the executable entry stub before calling user
code.

## C Strings Returned By Z3

Many Z3 APIs return `Z3_string` (`const char *`). These are borrowed pointers
managed by Z3. Convert them to a Silk `string` view using:

- `std::ffi::c::cstr_borrow(ptr: u64) -> string` (from `std/ffi/c.slk`)

The returned `string` is a borrowed view; it is valid only while the Z3-owned
storage remains valid.

## Platform Support

The current toolchain auto-link behavior for `std::runtime::z3` is supported
only on the hosted `linux/x86_64` backend (matching the shipped vendored Z3
archive).
